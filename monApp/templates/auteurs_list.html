{% extends 'base.html' %}

{% block main %}
  <div class="container mt-4">
    <h1 class="text-center mb-4">Liste des auteurs</h1>
    <p class="text-muted text-center">Nombre d'auteurs : <strong>{{ auteurs|length }}</strong></p>

    {% if auteurs|length == 0 %}
      <p class="alert alert-warning text-center">Aucun auteur trouvé.</p>
    {% endif %}

    <form id="search-form" method="get" action="{{ url_for('getAuteurs') }}" 
          class="d-flex justify-content-center mb-4">
      <input type="text" id="search-input" name="q" class="form-control w-50 me-2 rounded-pill shadow-sm" 
             placeholder="🔍 Rechercher un auteur..." value="{{ query }}">
      <input type="hidden" name="sort" value="{{ sort_by }}">
      <button type="submit" class="btn btn-primary rounded-pill">Rechercher</button>
    </form>

    <div class="d-flex justify-content-center mb-3 gap-2">
      <a href="{{ url_for('getAuteurs', q=query, sort='nom') }}" 
         class="btn btn-sm {% if sort_by == 'nom' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        Trier par nom
      </a>
      <a href="{{ url_for('getAuteurs', q=query, sort='livres_asc') }}" 
         class="btn btn-sm {% if sort_by == 'livres_asc' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        Livres ↑
      </a>
      <a href="{{ url_for('getAuteurs', q=query, sort='livres_desc') }}" 
         class="btn btn-sm {% if sort_by == 'livres_desc' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        Livres ↓
      </a>
    </div>

    <div id="results" class="table-responsive">
      <table class="table table-hover table-borderless align-middle shadow-sm rounded-3 overflow-hidden">
        <thead class="bg-dark text-white text-center">
          <tr>
            <th class="py-3">Nom</th>
            <th class="py-3">Nombre de livres</th>
            <th class="py-3">Actions</th>
          </tr>
        </thead>
        <tbody id="results-body" class="text-center">
          {% for unAuteur in auteurs %}
            <tr class="border-bottom">
              <td class="fw-bold">{{ unAuteur.Nom }}</td>
              <td>{{ unAuteur.livres.count() }}</td>
              <td>
                <div class="d-flex justify-content-center gap-2">
                  <a href="{{ url_for('viewAuteur', idA=unAuteur.idA) }}" 
                     class="btn btn-light border btn-sm rounded-circle shadow-sm" 
                     title="Voir">
                     👁️
                  </a>
                  {% if current_user.is_authenticated %}
                    <a href="{{ url_for('updateAuteur', idA=unAuteur.idA) }}" 
                       class="btn btn-light border btn-sm rounded-circle shadow-sm" 
                       title="Modifier">
                       ✏️
                    </a>
                    <a href="{{ url_for('deleteAuteur', idA=unAuteur.idA) }}" 
                       class="btn btn-light border btn-sm rounded-circle shadow-sm text-danger" 
                       title="Supprimer"
                       onclick="return confirm('Voulez-vous vraiment supprimer cet auteur ?');">
                       🗑️
                    </a>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/search_auteurs.js') }}"></script>
{% endblock %}